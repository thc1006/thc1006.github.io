<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>資源與實用工具箱｜ADHD 光譜</title>

    <!-- Puter.js：免 API Key 的 Gemini/LLM 代理 -->
    <script src="https://js.puter.com/v2/"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Manrope:wght@400;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Manrope', 'Noto Sans TC', sans-serif; background-color: #FEFDF8; color: #3D352E; }
        :focus-visible { outline: 3px solid #6D9886; outline-offset: 2px; border-radius: 6px; }
        .prose-custom { font-size: 1.125rem; line-height: 1.75; }
        .prose-custom h2 { font-size:2.25rem; font-weight:800; color:#A44A3F; margin:2.5em 0 1em; padding-bottom:.3em; border-bottom:2px solid #F2E1D9; }
        .prose-custom h3 { font-size:1.5rem; font-weight:700; color:#3D352E; margin:2em 0 .8em; }
        .prose-custom strong { color:#BF4040; font-weight:700; }
        .prose-custom a { color:#6D9886; text-decoration:underline; text-underline-offset:4px; }
        .prose-custom a:hover { color:#4A6B5B; }
        .resource-card { background:#fff; border:1px solid #F2E1D9; border-radius:1rem; box-shadow:0 4px 10px rgba(0,0,0,0.03); transition:transform .3s,box-shadow .3s; }
        .resource-card:hover { transform:translateY(-5px); box-shadow:0 8px 20px rgba(0,0,0,0.05); }
        .disclaimer-box { background:#FFFBEB; border:2px dashed #FBBF24; color:#92400E; }
        .loader { border:4px solid #f3f3f3; border-top:4px solid #6D9886; border-radius:50%; width:24px; height:24px; animation:spin 1s linear infinite; }
        @keyframes spin { 0%{transform:rotate(0);}100%{transform:rotate(360deg);} }
    </style>
</head>
<body class="antialiased">

    <!-- Header -->
    <header class="sticky top-0 z-50 bg-[#FEFDF8]/80 backdrop-blur-lg">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <!-- Logo omitted for brevity -->
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-12 md:py-20">
        <article class="max-w-4xl mx-auto prose-custom">
            <!-- Content omitted for brevity -->

            <!-- Gemini Note Generator Section -->
            <div id="gemini-note-generator" class="mt-8 border-t-2 border-dashed border-gray-200 pt-8">
                <h4 class="text-xl font-bold text-[#A44A3F] flex items-center"><span class="text-3xl mr-3">✨</span>AI 陪我寫看診筆記</h4>
                <textarea id="userInput" rows="8" class="w-full p-4 border-2 rounded-lg mt-4" placeholder="請輸入你的筆記..."></textarea>
                <button id="generateButton" class="mt-4 bg-[#D9534F] text-white py-3 px-6 rounded-full inline-flex items-center disabled:opacity-50">
                    <span id="buttonText">幫我整理筆記</span>
                    <div id="loader" class="loader ml-3 hidden"></div>
                </button>
                <div id="errorMessage" class="mt-6 bg-red-50 p-4 rounded-lg text-red-700 hidden"></div>
                <div id="geminiResult" class="mt-6 bg-green-50 p-6 rounded-lg border-l-4 border-green-500 hidden">
                    <h4 class="font-bold text-lg text-green-800">為你整理好的看診筆記：</h4>
                    <div id="resultContent" class="mt-2 text-gray-700 whitespace-pre-wrap"></div>
                    <button id="copyButton" class="mt-4 bg-gray-200 text-gray-700 py-1 px-3 rounded-md hover:bg-gray-300">複製內容</button>
                </div>
            </div>
        </article>
    </main>

    <!-- Footer omitted for brevity -->

<script>
    const generateButton = document.getElementById('generateButton');
    const buttonText = document.getElementById('buttonText');
    const loader = document.getElementById('loader');
    const userInput = document.getElementById('userInput');
    const geminiResult = document.getElementById('geminiResult');
    const resultContent = document.getElementById('resultContent');
    const errorMessage = document.getElementById('errorMessage');
    const copyButton = document.getElementById('copyButton');

    generateButton.addEventListener('click', async () => {
        const text = userInput.value.trim();
        if (!text) {
            errorMessage.textContent = '請先輸入你的想法！';
            errorMessage.classList.remove('hidden');
            return;
        }
        errorMessage.classList.add('hidden');
        geminiResult.classList.add('hidden');
        generateButton.disabled = true;
        buttonText.textContent = '整理中...';
        loader.classList.remove('hidden');

        // 組 prompt
        const prompt = `你是一位溫暖的心理健康助理。請將以下筆記整理成 Markdown 點列格式：\n---\n${text}\n---`;
        try {
            // 使用 Puter.js 呼叫模型
            const resp = await puter.ai.chat(prompt, { model: 'google/gemini-2.0-flash-lite-001', stream: false });
            const generated = resp?.message?.content || '無法生成筆記，請稍後再試。';
            // 顯示結果
            resultContent.innerHTML = generated.replace(/\n/g, '<br>');
            geminiResult.classList.remove('hidden');
        } catch (e) {
            console.error('LLM 調用失敗:', e);
            errorMessage.textContent = '整理筆記時發生錯誤，請稍後再試。';
            errorMessage.classList.remove('hidden');
        } finally {
            generateButton.disabled = false;
            buttonText.textContent = '幫我整理筆記';
            loader.classList.add('hidden');
        }
    });

    copyButton.addEventListener('click', () => {
        navigator.clipboard.writeText(resultContent.innerText).then(() => {
            copyButton.textContent = '已複製！';
            setTimeout(() => copyButton.textContent = '複製內容', 2000);
        }).catch(err => console.error('複製失敗:', err));
    });
</script>

</body>
</html>
